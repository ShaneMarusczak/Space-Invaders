"use strict";(()=>{let canFire=!0,gameStarted=!1,gameOver=!1,numberOfEnemies=0,destroyedEnemies=0,shotsFired=0,shipSpeed=1,movingRight=!0,justMovedDown=!1;const playerWinsOnLoad=Number(getCookie("playerWinsSpace")),playerLossesOnLoad=Number(getCookie("playerLossesSpace")),clockSpeed=375,playerLaserInterval=175,playerLaserIterations=28,tickMovement=25,imageStore=["images/enemy-4.png","images/enemy-2.png","images/enemy-3.png","images/enemy-1.png"],ship=document.getElementById("ship"),gameBoard=document.getElementById("gameBoard"),gameBoardRightSide=gameBoard.offsetWidth+gameBoard.offsetLeft,enemyShips=()=>Array.from(document.getElementsByClassName("enemyShip")),convertToPXs=num=>num+"px",randomIntFromInterval=(min,max)=>Math.floor(Math.random()*(max-min+1)+min),sleep=ms=>new Promise(resolve=>setTimeout(resolve,ms));function alertModalControl(message,duration){document.getElementById("alertshader").style.display="block",document.getElementById("alertmessage").innerText=message,sleep(duration).then(()=>{document.getElementById("alertshader").style.display="none"})}function setCookie(cname,cvalue,exdays){var d=new Date;d.setTime(d.getTime()+24*exdays*60*60*1e3);var expires="expires="+d.toUTCString();document.cookie=cname+"="+cvalue+";"+expires+";path=/"}function getCookie(cname){for(var name=cname+"=",decodedCookie,ca=decodeURIComponent(document.cookie).split(";"),i=0;i<ca.length;i++){for(var c=ca[i];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf(name))return c.substring(name.length,c.length)}return""}function shipControl(e){if(gameStarted&&!gameOver){const posLeft=ship.offsetLeft-gameBoard.offsetLeft-1;"37"==e.keyCode&&posLeft-25>=0?(e.preventDefault(),ship.style.marginLeft=convertToPXs(posLeft-25)):"39"==e.keyCode&&posLeft+25<=gameBoard.offsetWidth-100?(e.preventDefault(),ship.style.marginLeft=convertToPXs(posLeft+25)):"32"==e.keyCode&&canFire&&(e.preventDefault(),shotsFired++,canFire=!1,sleep(550).then(()=>{canFire=!0}),firePlayerLaser())}}const colides=(obj1,obj2)=>!(obj2.offsetLeft>obj1.offsetWidth+obj1.offsetLeft||obj1.offsetLeft>obj2.offsetWidth+obj2.offsetLeft||obj2.offsetTop>obj1.offsetHeight+obj1.offsetTop||obj1.offsetTop>obj2.offsetHeight+obj2.offsetTop);function firePlayerLaser(){const laser=document.createElement("div");laser.classList.add("laser"),laser.style.left=convertToPXs(ship.offsetLeft+45),laser.style.top=convertToPXs(ship.offsetTop-30),ship.appendChild(laser);for(let i=0;i<28;i++)sleep(175*i).then(()=>{laser.style.top=convertToPXs(ship.offsetTop-50-25*i),enemyShips().forEach(es=>{colides(es,laser)&&(laser.remove(),es.remove(),destroyedEnemies++,destroyedEnemies===numberOfEnemies&&(gameOverHandler("You Win!"),setCookie("playerWinsSpace",playerWinsOnLoad+1,10),document.getElementById("playerWins").innerText="Wins: "+(playerWinsOnLoad+1)))})});sleep(4900).then(()=>laser.remove())}function fireComputerLaser(shouldReFire){if(!gameOver){const laser=document.createElement("div");laser.classList.add("enemyLaser");const shipToFire=enemyShips()[randomIntFromInterval(0,enemyShips().length-1)];document.getElementById("enemies").appendChild(laser),laser.style.left=convertToPXs(33.5+Number(shipToFire.style.left.substring(0,shipToFire.style.left.length-2))+Number(shipToFire.style.marginLeft.substring(0,shipToFire.style.marginLeft.length-2))),laser.style.top=convertToPXs(40+Number(shipToFire.style.top.substring(0,shipToFire.style.top.length-2))+Number(shipToFire.style.marginTop.substring(0,shipToFire.style.marginTop.length-2))),moveComputerLaser(laser,shouldReFire)}}function moveComputerLaser(laser,shouldReFire){colides(ship,laser)?(ship.remove(),laser.remove(),gameOverHandler("You Lose!"),setCookie("playerLossesSpace",playerLossesOnLoad+1,10),document.getElementById("playerLosses").innerText="Losses: "+(playerLossesOnLoad+1)):laser.offsetTop>=ship.offsetTop?(laser.remove(),shouldReFire&&!gameOver&&sleep(randomIntFromInterval(350,550)).then(()=>{fireComputerLaser(shouldReFire)})):sleep(200).then(()=>{laser.style.marginTop=convertToPXs(Number(laser.style.marginTop.substring(0,laser.style.marginTop.length-2))+25),moveComputerLaser(laser,shouldReFire)})}function startGame(){gameStarted||(alertModalControl("Start!",1500),sleep(1500).then(()=>{gameStarted=!0,gameTick(),fireComputerLaser(!0)}))}function lossChecker(){enemyShips().some(es=>es.offsetTop+30>=ship.offsetTop)&&(gameOverHandler("You Lose!"),setCookie("playerLossesSpace",playerLossesOnLoad+1,10),document.getElementById("playerLosses").innerText="Losses: "+(playerLossesOnLoad+1))}function gameOverHandler(message){gameOver=!0,alertModalControl(message,2e3),Array.from(document.getElementsByClassName("laser")).forEach(l=>l.remove()),Array.from(document.getElementsByClassName("enemyLaser")).forEach(l=>l.remove()),shotsFired>0&&(document.getElementById("shotsFired").innerText="Shots Fired: "+shotsFired,document.getElementById("accuracy").innerText="Accuracy: "+Math.floor(destroyedEnemies/shotsFired*100)+"%")}function gameTick(){gameOver||(enemiesOnLeftEdge()&&!justMovedDown?(moveEnemyShipsDown(),movingRight=!0):enemiesOnRightEdge()&&!justMovedDown?(moveEnemyShipsDown(),movingRight=!1):moveEnemyShips(),15===randomIntFromInterval(1,15)&&fireComputerLaser(!1),lossChecker(),gameOver||sleep(375-14*shipSpeed).then(()=>gameTick()))}const enemiesOnRightEdge=()=>enemyShips().some(es=>es.offsetLeft+25+75>=gameBoardRightSide),enemiesOnLeftEdge=()=>enemyShips().some(es=>es.offsetLeft-25<=gameBoard.offsetLeft);function moveEnemyShipsDown(){shipSpeed++,enemyShips().forEach(es=>{es.style.marginTop=convertToPXs(Number(es.style.marginTop.substring(0,es.style.marginTop.length-2))+25)}),justMovedDown=!0}function moveEnemyShips(){movingRight?enemyShips().forEach(es=>{es.style.marginLeft=convertToPXs(Number(es.style.marginLeft.substring(0,es.style.marginLeft.length-2))+25)}):enemyShips().forEach(es=>{es.style.marginLeft=convertToPXs(Number(es.style.marginLeft.substring(0,es.style.marginLeft.length-2))-25)}),justMovedDown=!1}(()=>{for(let i=1;i<5;i++){const shipImgToUse=imageStore[i-1];for(let j=1;j<8;j++){const enemyShip=document.createElement("div"),shipImg=document.createElement("img");shipImg.src=shipImgToUse,shipImg.classList.add("enemyShipImg"),enemyShip.appendChild(shipImg),enemyShip.classList.add("enemyShip"),enemyShip.style.top=convertToPXs(60*i+document.getElementById("gameBoard").offsetTop),enemyShip.style.left=convertToPXs(120*j+document.getElementById("gameBoard").offsetLeft),document.getElementById("enemies").appendChild(enemyShip),numberOfEnemies++}}document.addEventListener("keydown",shipControl),document.getElementById("start").addEventListener("click",startGame),document.getElementById("reload").addEventListener("click",()=>location.reload()),document.getElementById("playerWins").innerText="Wins: "+playerWinsOnLoad,document.getElementById("playerLosses").innerText="Losses: "+playerLossesOnLoad})()})();