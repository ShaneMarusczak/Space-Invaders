(()=>{function W(a){if(w&&!k){const c=f.offsetLeft-F.offsetLeft-1;("ArrowLeft"===a.key||"a"===a.key)&&0<=c-25?(a.preventDefault(),f.style.marginLeft=c-25+"px"):("ArrowRight"===a.key||"d"===a.key)&&c+25<=F.offsetWidth-100?(a.preventDefault(),f.style.marginLeft=c+25+"px"):" "!==a.key&&"ArrowUp"!==a.key&&"w"!==a.key||!x||(a.preventDefault(),y++,x=!1,g(G).then(()=>{x=!0}),X())}}function X(){const a=document.createElement("div");a.classList.add("laser");a.style.left=f.offsetLeft+45+"px";a.style.top=f.offsetTop-
30+"px";f.appendChild(a);for(let c=0;28>c;c++)g(c*z).then(()=>{a.style.top=f.offsetTop-50-25*c+"px";document.querySelectorAll(".blocker").forEach(b=>{l(b,a)&&(a.remove(),b.classList.remove("blocker"))});m().forEach(b=>{l(b,a)&&Y(b,a)})});g(28*z).then(()=>{a.parentElement&&(q=0,a.remove())})}function Y(a,c){c.remove();a.remove();A++;q++;h+=(Math.floor(q/10)+1)*Number(a.attributes.points.value);document.getElementById("winLoss").classList.add("pointsFlash");g(750).then(()=>document.getElementById("winLoss").classList.remove("pointsFlash"));
document.getElementById("points").textContent=h;0===q%10&&(H("The Enemy Retreats!"),r("ver",-1));A===I&&(J("You Win!"),n("playerWinsSpace",B+1,10),document.getElementById("playerWins").textContent=B+1,document.getElementById("myCanvas").style.display="block")}function t(a){if(!k){const b=document.createElement("div");var c=m();b.classList.add("enemyLaser");c=c[u(0,c.length-1)].attributes.currentCell.value;document.getElementById("cell-"+c).appendChild(b);K(b,a)}}function K(a,c){let b=!1;document.querySelectorAll(".blocker").forEach(d=>
{l(d,a)&&(a.remove(),d.classList.remove("blocker"),c&&t(!0),b=!0)});b||(l(f,a)?(f.remove(),a.remove(),L()):a.offsetTop>=f.offsetTop?(a.remove(),c&&!k&&g(u(350,550)).then(()=>{t(c)})):g(200).then(()=>{a.style.marginTop=Number(a.style.marginTop.substring(0,a.style.marginTop.length-2))+25+"px";K(a,c)}))}function Z(){w||(document.getElementById("start").classList.remove("startButtonFlash"),document.getElementById("winLoss").scrollIntoView(),M("Start!",1500),g(1500).then(()=>{w=!0;N();t(!0)}))}function aa(){m().some(a=>
l(a,f)||"30"===a.attributes.currentCell.value.split("-")[0])&&L()}function L(){n("playerLossesSpace",C+1,10);document.getElementById("playerLosses").textContent=C+1;h=0;n("currentPointsSpace",0,10);document.getElementById("points").textContent=0;O=!0;J("You Lose!")}function J(a){k=!0;M(a,2E3);Array.from(document.getElementsByClassName("laser")).forEach(c=>c.remove());Array.from(document.getElementsByClassName("enemyLaser")).forEach(c=>c.remove());n("currentPointsSpace",h,10);h>P&&!O&&(n("highScoreSpace",
h,10),document.getElementById("highScore").textContent=h);document.getElementById("reload").textContent="Play Again"}function H(a){const c=document.getElementById("upgradeText");c.textContent=a;g(4E3).then(()=>{c.textContent=""})}function N(){k||(Q("0")&&!p?(r("ver",1),p=!0,D++,E=1):Q("46")&&!p?(r("ver",1),p=!0,D++,E=-1):(r("hor",E),p=!1),5===u(1,10)&&t(5===u(1,15)),0===y%10&&.65<A/y&&!R&&(H("Laser Upgraded!"),G=500,z=150,R=!0),aa(),k||g(S-16*D).then(()=>N()))}function r(a,c){const b=document.querySelectorAll(".blocker");
m().forEach(d=>{var e=Number(d.attributes.currentCell.value.split("-")[0]);const T=Number(d.attributes.currentCell.value.split("-")[1]),U=d.parentElement.removeChild(d);e="hor"===a?e+"-"+(T+c):e+c+"-"+T;U.attributes.currentCell.value=e;document.getElementById("cell-"+e).appendChild(U);b.forEach(V=>{l(V,d)&&V.classList.remove("blocker")})})}function u(a,c){return Math.floor(Math.random()*(c-a+1)+a)}function g(a){return new Promise(c=>setTimeout(c,a))}function n(a,c,b){const d=new Date;d.setTime(d.getTime()+
864E5*b);b="expires="+d.toUTCString();document.cookie=a+"="+c+";"+b+";path=/;SameSite=Lax"}function v(a){a+="=";const c=decodeURIComponent(document.cookie).split(";");for(let b=0;b<c.length;b++){let d=c[b];for(;" "===d.charAt(0);)d=d.substring(1);if(0===d.indexOf(a))return d.substring(a.length,d.length)}return""}function M(a,c){const b=document.createElement("div");b.id="modal-box";const d=document.createElement("div");d.id="inner-modal-box";const e=document.createElement("span");e.id="modal-message";
d.appendChild(e);b.appendChild(d);e.innerText=a;document.getElementsByTagName("html")[0].appendChild(b);g(c).then(()=>b.remove())}let x=!0,w=!1,k=!1,I=0,A=0,y=0,D=1,E=1,p=!1,z=175,G=550,R=!1,q=0,S=375,h=Number(v("currentPointsSpace")),O=!1;const P=Number(v("highScoreSpace")),B=Number(v("playerWinsSpace")),C=Number(v("playerLossesSpace")),ba=["images/enemy-4.png","images/enemy-2.png","images/enemy-3.png","images/enemy-1.png"],f=document.getElementById("ship"),F=document.getElementById("gameBoard"),
m=()=>Array.from(document.getElementsByClassName("enemyShip")),l=(a,c)=>!(c.offsetLeft>a.offsetWidth+a.offsetLeft||a.offsetLeft>c.offsetWidth+c.offsetLeft||c.offsetTop>a.offsetHeight+a.offsetTop||a.offsetTop>c.offsetHeight+c.offsetTop),Q=a=>m().some(c=>c.attributes.currentCell.value.split("-")[1]===a);(()=>{for(var a=0;32>a;a++){var c=document.createElement("div");document.getElementById("enemies").appendChild(c);c.classList.add("ship-row");c.id="row-"+a;for(var b=0;50>b;b++){var d=document.createElement("div");
c.appendChild(d);d.classList.add("ship-cell");d.id="cell-"+a+"-"+b;if(!(25!==a&&26!==a||2!==b&&3!==b&&4!==b&&5!==b&&6!==b&&12!==b&&13!==b&&14!==b&&15!==b&&16!==b&&22!==b&&23!==b&&24!==b&&25!==b&&26!==b&&32!==b&&33!==b&&34!==b&&35!==b&&36!==b&&42!==b&&43!==b&&44!==b&&45!==b&&46!==b)){if(25===a&&(2===b||6===b||12===b||16===b||22===b||26===b||32===b||36===b||42===b||46===b))continue;d.classList.add("blocker")}27!==a||2!==b&&6!==b&&12!==b&&16!==b&&22!==b&&26!==b&&32!==b&&36!==b&&42!==b&&46!==b||d.classList.add("blocker")}}for(a=
1;5>a;a++)for(c=ba[a-1],b=1;8>b;b++){d=document.createElement("div");const e=document.createElement("img");e.src=c;e.classList.add("enemyShipImg");d.appendChild(e);d.classList.add("enemyShip");document.getElementById("cell-"+3*a+"-"+6*b).appendChild(d);d.setAttribute("currentCell",3*a+"-"+6*b);d.setAttribute("points",-10*a+60);I++}document.addEventListener("keydown",W);document.getElementById("start").addEventListener("click",Z);document.getElementById("playerWins").textContent=B;document.getElementById("playerLosses").textContent=
C;document.getElementById("highScore").textContent=P;document.getElementById("points").textContent=h;S-=h/500*5;window.onkeydown=e=>!((" "===e.key||"ArrowUp"===e.key)&&e.target===document.body)})()})();
